---
title: "[jpa] MyBatisë¡œ DB ì—°ë™í•˜ê¸°"
excerpt: "MyBatisë¡œ DB ì—°ë™í•˜ê¸°"

categories:
  - jpa
tags:
  - [jpa]

permalink: /jpa/myBatis/

toc: false

date: 2022-06-02
last_modified_at: 2022-06-02
---

![myBatis](/assets/images/posts_img/myBatis.png)

**myBatisëŠ” SQL ë§¤í¼ í”„ë ˆì„ì›Œí¬**ì…ë‹ˆë‹¤. 'ë§¤í¼ í”„ë ˆì„ì›Œí¬'.. ë‹¨ì–´ê°€ ì–´ë µì§€ìš”?<br />

ë‹¨ì–´ëŠ” ì°¨ì¹˜í•˜ê³  myBatisëŠ” ì™œ ê°œë°œëì„ê¹Œìš”? myBatisëŠ” JDBC ë‹¨ì  ë•Œë¬¸ì— ë“±ì¥í–ˆìŠµë‹ˆë‹¤. JDBCì˜ ë‹¨ì ì€ ë­˜ê¹Œìš”?<br />

â‘  ì¤‘ë³µ ì½”ë“œ ì‘ì„±(getConnection, close)<br />
â‘¡ SQL êµ¬ë¬¸ì´ DAOì— í¬í•¨<br />[JDBC ì¥Â·ë‹¨ì ì´ ê¶ê¸ˆí•˜ì‹œë‹¤ë©´..ğŸ§·](https://parkirae.github.io/jpa/JDBC/)<br />

myBatisëŠ” ì´ ë‘ê°€ì§€ ë¬¸ì œë¥¼ í•´ê²°í–ˆìŠµë‹ˆë‹¤.<br />


**â‘  ë”ì´ìƒ ì¤‘ë³µ ì½”ë“œë¥¼ ì‘ì„±í•˜ì§€ ì•Šì•„ë„ ë˜ì£ .**<br/>
Connection, closeë¥¼ myBatisê°€ ëŒ€ì‹  ì²˜ë¦¬í•©ë‹ˆë‹¤.<br />

**â‘¡ SQLì´ ë³€ê²½ë˜ë”ë¼ë„ ìë°” ì†ŒìŠ¤ë¥¼ ë³€ê²½í•˜ì§€ ì•Šì•„ë„ ë©ë‹ˆë‹¤.**<br/>
SQL êµ¬ë¬¸ì€ xml íŒŒì¼ì„ ë§Œë“¤ì–´ì„œ ê´€ë¦¬í•©ë‹ˆë‹¤.<br />

DBì—°ë™ì´ ì–¼ë§ˆë‚˜ í¸í•´ì¡ŒëŠ”ì§€ í•œë²ˆ ì‚´í´ë³¼ê¹Œìš”?<br />

---
<br />
ì‹¤ìŠµ ìˆœì„œëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.<br />

â‘  VO(Value Object) ì‘ì„±<br />
â‘¡ SQL Mapper ì‘ì„±<br />
â‘¢ myBatis ë©”ì¸ ì„¤ì • íŒŒì¼ ì‘ì„±<br />
â‘£ DAO(Data Access Object) ì‘ì„±<br />
â‘¤ Client ì‘ì„±<br />

---
<br />
## 1. VO
<br />
VOëŠ” JDBC ì‹¤ìŠµì—ì„œ ì‚¬ìš©í•œ ê²ƒê³¼ ë™ì¼í•©ë‹ˆë‹¤.<br />


```java
package com.rubypaper.persistence.mybatis;

import lombok.Data;

import java.sql.Timestamp;

@Data
public class EmployeeVO {

    private Long id;
    private String name;
    private Timestamp startDate;
    private String title;
    private String deptName;
    private Double salary;
}
```

<br />

## 2. SQL mapper
<br />
SQL Mapper XML ë“±ë¡ëœ SQLì€ ì¤‘ë³µë˜ì§€ ì•ŠëŠ” idë¥¼ ê°€ì ¸ì•¼ í•©ë‹ˆë‹¤. (ì•„ë˜ì—ì„œëŠ” insertEmployee, getEmployeeListë¼ê³  ì‘ì„±í–ˆìŠµë‹ˆë‹¤.<br />

insertEmployeeëŠ” parameterTypeìœ¼ë¡œ employeeVO ê°ì²´ë¥¼ ë°›ì•„ì„œ ë°”ì¸ë”©í•˜ê³  ìˆìŠµë‹ˆë‹¤. (ì½”ë“œì—ì„œ employeeëŠ” EmployeeVOì˜ ë³„ì¹­(Alias)ì…ë‹ˆë‹¤. myBatis ë©”ì¸ ì„¤ì •íŒŒì¼ì—ì„œ ë³„ì¹­ì„ ì„ ì–¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.)<br />

getEmployeeListëŠ” íŒŒë¼ë¯¸í„°ê°€ ì—†ì–´ì„œ parameterType ì†ì„±ì„ ì‚¬ìš©í•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ê²€ìƒ‰ ê²°ê³¼ê°€ EmployeeVO ê°ì²´ì— ë§¤í•‘ë˜ë„ë¡ resultMap ì†ì„±ì„ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤.<br />


```xml
<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE mapper PUBLIC "-//matabis.org//DTD Mapper 3.0//EN" "http://mabatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="EmployeeDAO">

    <!--ResultMap ì„ ì–¸-->
    <resultMap type="" id="employeeResult">
        <result property="id" column="ID"/>
        <result property="name" column="NAME"/>
        <result property="startDate" column="START_DATE"/>
        <result property="title" column="TITLE"/>
        <result property="deptName" column="DEPT_NAME"/>
        <result property="salary" column="SALARY"/>
    </resultMap>

    <!--ì§ì› ë“±ë¡ SQL-->
    <insert id="insertEmployee" parameterType="employee">
        INSERT INTO s_emp(id, name, start_date, title, dept_name, salary)
        VALUES((SELECT nvl(max(id), 0) + 1 FROM s_emp),
        #{name},
        #{startDate},
        #{title},
        #{deptName},
        #{salary},
    </insert>

    <!--ì§ì› ëª©ë¡ ê²€ìƒ‰ SQL-->
    <select id="getEmployeeList" resultMap="employeeResult">
        SELECT id, name, start_date, title, dept_name, salary
        FROM s_emp
        ORDER BY name
    </select>
</mapper>
```

<br />

## 3. myBatis ë©”ì¸ ì„¤ì • íŒŒì¼
<br />
â‘  ë³„ì¹­(Alias)ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤. ë³„ì¹­ì€ SQL Mapper XML(s_emp_mapping.xml)ì—ì„œ ì‚¬ìš©í•©ë‹ˆë‹¤.<br />

â‘¡ ë°ì´í„° ì†ŒìŠ¤ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤. ì—¬ê¸°ì„œëŠ” H2 DBë¥¼ ì„¤ì •í–ˆìŠµë‹ˆë‹¤.<br />

â‘¢ SQL Mapper XML(s_emp-mapping.xml)ì„ ë“±ë¡í•©ë‹ˆë‹¤.<br />


```xml
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE configuration PUBLIC "-//mybatis.org//DTD Config 3.0//EN" "http://mybatis.org/dtd/mybatis-3-config.dtd">

<configuration>

    <!--ë§¤í¼ XML(s_emp_mapping.xml)ì—ì„œ ì‚¬ìš©í•  Alias ì„ ì–¸-->
    <typeAliases>
        <typeAlias alias="employee" type="com.rubypaper.persistence.mybatis.EmployeeVO"/>
    </typeAliases>

    <!--ë°ì´í„°ì†ŒìŠ¤ ì„¤ì •-->
    <environments default="development">
        <environment id="development">
            <transactionManager type="JDBC"></transactionManager>
            <dataSource type="POOLED">
                <property name="driver" value="org.h2.Driver"/>
                <property name="url" value="jdbc:h2:tcp://localhost/~/test"/>
                <property name="username" value="sa"/>
                <property name="password" value=""/>
            </dataSource>
        </environment>
    </environments>

    <!--ë§¤í¼ XML(s_emp_mapping.xml) ë“±ë¡-->
    <mappers>
        <mapper resource="com/rubypaper/persistence/mybatis/s_emp_mapping"/>
    </mappers>
</configuration>
```

<br />

## 4. DAO
<br />
myBatisë¥¼ ì‚¬ìš©í•˜ë ¤ë©´ SqlSession ê°ì²´ê°€ í•„ìš”í•©ë‹ˆë‹¤. SqlSession ê°ì²´ëŠ” ì•„ë˜ ë°©ë²•ìœ¼ë¡œ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. (SqlSessionì—ëŠ” ë°ì´í„° ì†ŒìŠ¤ì™€ sql-map-config.xmlì— ì„¤ì •í•œ ì •ë³´ê°€ ë“¤ì–´ ìˆìŠµë‹ˆë‹¤.)<br />

â‘  sql-map-config.xmlì„ ë¡œë”©í•´ì„œ SqlSessionFactoryë¥¼ ìƒì„±í•©ë‹ˆë‹¤.<br />
â‘¡ SqlSessionFactoryì˜ openSession()ì„ í†µí•´ SqlSessionì„ ìƒì„±í•©ë‹ˆë‹¤.<br />



```java
package com.rubypaper.persistence.mybatis;

import org.apache.ibatis.io.Resources;
import org.apache.ibatis.session.SqlSession;
import org.apache.ibatis.session.SqlSessionFactory;
import org.apache.ibatis.session.SqlSessionFactoryBuilder;

import java.io.IOException;
import java.io.Reader;
import java.util.List;

public class EmployeeDAO {

    private SqlSession mybatis;

    public EmployeeDAO() {

        try {
            Reader reader = Resources.getResourceAsReader("com/rubypaper/persistence/mybatis/sql-map-config.xml");
            SqlSessionFactory sessionFactory = new SqlSessionFactoryBuilder().build(reader);
            mybatis = sessionFactory.openSession();
        } catch (IOException e) {
            e.printStackTrace();
        }
    }

    public void insertEmployee(EmployeeVO vo) {
        System.out.println("===> MyBatis ê¸°ë°˜ìœ¼ë¡œ íšŒì› ë“±ë¡");
        mybatis.insert("EmployeeDAO.insertEmployee", vo);
        mybatis.commit();
    }

    public List<EmployeeVO> getEmployeeList() {
        System.out.println("===> MyBatis ê¸°ë°˜ìœ¼ë¡œ íšŒì› ëª©ë¡ ì¡°íšŒ");
        return mybatis.selectList("EmployeeDAO.getEmployeeList");
    }
}
```
<br />

## 5. Client
<br />
ClientëŠ” DAOì— êµ¬í˜„ëœ ë©”ì„œë“œì˜ ê¸°ëŠ¥ì„ í™•ì¸í•©ë‹ˆë‹¤.<br />


```java
package com.rubypaper.persistence.mybatis;

import java.sql.Timestamp;
import java.util.List;

public class EmployeeServiceClient {

    public static void main(String[] args) {
        EmployeeVO vo = new EmployeeVO();
        vo.setName("ë‘˜ë¦¬");
        vo.setStartDate(new Timestamp(System.currentTimeMillis()));
        vo.setTitle("ì‚¬ì›");
        vo.setDeptName("ì˜ì—…ë¶€");
        vo.setSalary(1700.00);

        EmployeeDAO employeeDAO = new EmployeeDAO();
        employeeDAO.insertEmployee(vo);

        List<EmployeeVO> employeeList = employeeDAO.getEmployeeList();
        for (EmployeeVO employee : employeeList) {
            System.out.println("---> " + employee.toString());
        }
    }
}
```

<br />

## ì‹¤í–‰ ê²°ê³¼

![myBatis_1](/assets/images/posts_img/myBatis_1.png)


JDBCì— ë¹„í•´ ì½”ë“œê°€ í•œê²° ê°„ê²°í•´ì¡ŒìŠµë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ì—¬ì „íˆ SQLì„ ì§ì ‘ ê´€ë¦¬í•´ì•¼ í•˜ëŠ” ë²ˆê±°ë¡œì›€ì´ ìˆìŠµë‹ˆë‹¤.<br />

myBatisì˜ ë‹¨ì ì„ ë³´ì™„í•˜ê¸° ìœ„í•´ ORM(Object-Relational Mapping) Frameworkê°€ ë“±ì¥í–ˆìŠµë‹ˆë‹¤. ë‹¤ìŒ ê¸€ì—ì„œëŠ” ORM Framework ì¤‘ Hibernateë¡œ DB ì—°ë™ì„ í•´ë³´ê² ìŠµë‹ˆë‹¤.<br />


---

### ì°¸ê³ ë¬¸í—Œ

**JPA í€µìŠ¤íƒ€íŠ¸**

ì±„ê·œíƒœ ì§€ìŒã…£ë£¨ë¹„í˜ì´í¼ã…£2020ã…£[**ë„ì„œ ì •ë³´**](http://www.kyobobook.co.kr/product/detailViewKor.laf?ejkGb=KOR&mallGb=KOR&barcode=9791186710586&orderClick=LAG&Kc=)
